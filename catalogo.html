<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Catálogo • HAS</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css" />

  <!-- Estilos extras apenas para o catálogo (não mexe no seu CSS principal) -->
  <style>
    /* Mantém a vibe do site, mas cria o “catálogo Mercado Livre” */
    .catalog-toolbar {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      margin: 14px 0 18px;
    }

    .catalog-toolbar .left,
    .catalog-toolbar .right {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    .catalog-input, .catalog-select {
      font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(2, 6, 23, 0.35);
      color: #e2e8f0;
      outline: none;
      min-width: 240px;
    }

    .catalog-select { min-width: 200px; }

    .catalog-input::placeholder { color: rgba(226, 232, 240, 0.55); }

    .ml-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
      gap: 16px;
      margin-top: 14px;
    }

    .ml-card {
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 16px;
      overflow: hidden;
      background: rgba(0,0,0,0.28);
      backdrop-filter: blur(8px);
      display: flex;
      flex-direction: column;
      min-height: 330px;
      transition: transform .15s ease, border-color .15s ease;
      cursor: pointer;
    }

    .ml-card:hover {
      transform: translateY(-2px);
      border-color: rgba(250, 204, 21, 0.45); /* amarelo neon sutil */
    }

    .ml-img {
      width: 100%;
      aspect-ratio: 1 / 1;
      background: rgba(255,255,255,0.06);
      display: grid;
      place-items: center;
      overflow: hidden;
    }

    .ml-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.02);
    }

    .ml-body {
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
    }

    .ml-title {
      font-size: 0.9rem;
      line-height: 1.2;
      color: #e2e8f0;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      min-height: 2.2em;
    }

    .ml-price {
      font-size: 1.1rem;
      font-weight: 700;
      color: #fde047; /* amarelo forte */
    }

    .ml-meta {
      font-size: 0.78rem;
      color: rgba(226, 232, 240, 0.72);
    }

    .ml-actions {
      margin-top: auto;
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }

    .ml-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 0;
      cursor: pointer;
      text-decoration: none;
      font-weight: 700;
      width: 100%;
      background: #fde047;
      color: #111827;
      transition: transform .12s ease, filter .12s ease;
      user-select: none;
    }

    .ml-btn:hover { transform: translateY(-1px); filter: brightness(0.98); }

    .ml-skeleton {
      padding: 12px;
      color: rgba(226, 232, 240, 0.70);
      font-size: 0.9rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.25);
      background: rgba(2,6,23,0.25);
      color: rgba(226,232,240,0.85);
      font-size: 0.78rem;
    }

    .catalog-hint {
      margin-top: 6px;
      font-size: 0.85rem;
      color: rgba(226,232,240,0.75);
    }

    @media (max-width: 520px) {
      .catalog-input { min-width: 100%; }
      .catalog-select { min-width: 100%; }
      .catalog-toolbar { gap: 10px; }
    }
  </style>
</head>

<body>
  <!-- Navegação -->
  <nav>
    <div class="logo">
      <a href="index.html"><img src="assets/img/logo.png" alt="Logo HAS" loading="lazy" /></a>
    </div>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="marcas.html">Marcas</a></li>
      <li><a href="diluicao.html">Calculadora de Diluição</a></li>
      <li><a href="nossaempresa.html">Quem Somos</a></li>
      <li><a href="contato.html">Fale Conosco</a></li>
    </ul>
    <div class="menu-toggle">
      <span></span><span></span><span></span>
    </div>
  </nav>

  <!-- Cabeçalho -->
  <section class="hero" style="background-image: url('assets/img/placeholder_light_gray_block.png');">
    <div class="hero-content">
      <h1>Catálogo</h1>
      <p>Produtos selecionados — clique e compre direto no Mercado Livre</p>
    </div>
  </section>

  <!-- Conteúdo: Catálogo -->
  <section class="content">
    <h2>Produtos</h2>

    <div class="catalog-toolbar">
      <div class="left">
        <input id="catalogSearch" class="catalog-input" type="search" placeholder="Buscar por nome…" />
        <select id="catalogSort" class="catalog-select">
          <option value="relevance">Ordenar: Relevância</option>
          <option value="price_asc">Preço: menor → maior</option>
          <option value="price_desc">Preço: maior → menor</option>
          <option value="title_asc">Nome: A → Z</option>
          <option value="title_desc">Nome: Z → A</option>
        </select>
      </div>

      <div class="right">
        <span class="badge" id="catalogCount">0 itens</span>
        <span class="badge" id="catalogStatus">Carregando…</span>
      </div>
    </div>

    <p class="catalog-hint">
      //Dica: aqui você só cola links do Mercado Livre e o site puxa foto, nome e preço automaticamente.
    </p>

    <!-- Você só lista links aqui (um por item) -->
    <div class="ml-grid" id="mlGrid">
      <!-- EXEMPLOS: troque pelos seus -->
      <div class="ml-item" data-ml-url="https://produto.mercadolivre.com.br/MLB-6160149854-shampoo-multifuncional-500ml-ziox-alcance-remove-chuva-acida"></div>
      <div class="ml-item" data-ml-url="https://produto.mercadolivre.com.br/MLB9876543210-outro-produto-_JM"></div>
      <!-- Adicione mais assim:
      <div class="ml-item" data-ml-url="LINK_AQUI"></div>
      -->
    </div>
  </section>

  <!-- Rodapé -->
  <footer>
    <div style="text-align: center; padding: 24px 0; color: #94a3b8; font-size: 0.875rem;">
      <p>&copy; 2025 HAS – Produtos para Estética Automotiva</p>
      <p>Da lavagem à vitrificação, temos a solução! Desenvolvido por MGA Concept.</p>
      <p>
        <a href="mailto:hasprodutosautomotivos@gmail.com">hasprodutosautomotivos@gmail.com</a> |
        <a href="https://www.instagram.com/hasprodutosautomotivos/" target="_blank" rel="noopener">Instagram</a> |
        <a href="https://api.whatsapp.com/send/?phone=5543984510877&text&type=phone_number&app_absent=0" target="_blank" rel="noopener">WhatsApp</a>
      </p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="js/script.js"></script>
  <script src="js/banner_animado.js"></script>

 <script>
const CATALOG_JSON_URL = "/assets/produtos/produtos.json";
const IMAGE_BASE_PATH = "/assets/produtos/imagens";

  let originalItems = []; // ordem original do JSON (relevance)
  let renderedItems = []; // itens com imagem resolvida

  function formatBRL(value) {
    const n = Number(value);
    if (!Number.isFinite(n) || n <= 0) return "Consulte";
    return new Intl.NumberFormat("pt-BR", { style: "currency", currency: "BRL" }).format(n);
  }

  function escapeHtml(str) {
    return String(str ?? "").replace(/[&<>"']/g, (m) => ({
      "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#039;"
    }[m]));
  }

  // tenta achar a imagem local: .jpg -> .png -> .webp
  async function resolveLocalImage(itemId) {
    const candidates = [
      `${IMAGE_BASE_PATH}/${itemId}.jpg`,
      `${IMAGE_BASE_PATH}/${itemId}.png`,
      `${IMAGE_BASE_PATH}/${itemId}.webp`
    ];

    for (const src of candidates) {
      try {
        const res = await fetch(src, { method: "HEAD", cache: "no-store" });
        if (res.ok) return src;
      } catch (_) {}
    }
    return ""; // sem imagem encontrada
  }

  function normalizeMLBId(rawId) {
  if (!rawId) return "";

  const id = String(rawId).trim().toUpperCase();

  // Já está no formato MLB-123?
  if (/^ML[A-Z]-\d+$/.test(id)) return id;

  // Formato MLB123 -> MLB-123
  if (/^ML[A-Z]\d+$/.test(id)) {
    return id.replace(/^([A-Z]+)(\d+)$/, "$1-$2");
  }

  // fallback: retorna como veio
  return id;
}

function buildMLUrl(item) {
  // Se o JSON já tiver url completa, usa ela
  if (item.url && String(item.url).trim()) {
    return String(item.url).trim();
  }

  // Normaliza o item_id vindo do Excel
  if (item.item_id) {
    const fixedId = normalizeMLBId(item.item_id);
    return `https://produto.mercadolivre.com.br/${fixedId}`;
  }

  return "#";
}

  function renderCard(item) {
    const title = escapeHtml(item.title || "Produto");
    const price = formatBRL(item.price);
    const url = buildMLUrl(item);
    const img = item._resolved_image; // já resolvida
    const stock = Number.isFinite(Number(item.quantity)) ? `Estoque: ${item.quantity}` : "";

    return `
      <div class="ml-item">
        <div class="ml-card" data-title="${escapeHtml((item.title || "").toLowerCase())}" data-price="${Number(item.price) || 0}">
          <div class="ml-img">
            ${img ? `<img src="${img}" alt="${title}" loading="lazy">` : `<div class="ml-skeleton">Sem imagem</div>`}
          </div>
          <div class="ml-body">
            <div class="ml-title">${title}</div>
            <div class="ml-price">${price}</div>
            <div class="ml-meta">${stock}</div>
            <div class="ml-actions">
              <a class="ml-btn" href="${url}" target="_blank" rel="noopener noreferrer">Comprar no Mercado Livre</a>
            </div>
          </div>
        </div>
      </div>
    `;
  }

  function updateBadges(total, statusText) {
    const countEl = document.getElementById("catalogCount");
    const statusEl = document.getElementById("catalogStatus");
    if (countEl) countEl.textContent = `${total} item${total === 1 ? "" : "s"}`;
    if (statusEl) statusEl.textContent = statusText;
  }

  function applySearchAndSort() {
    const grid = document.getElementById("mlGrid");
    const q = (document.getElementById("catalogSearch")?.value || "").trim().toLowerCase();
    const sort = document.getElementById("catalogSort")?.value || "relevance";

    // começa da base original, mas com imagem resolvida
    let list = renderedItems.slice();

    // filtro por busca
    if (q) {
      list = list.filter(it => (it.title || "").toLowerCase().includes(q));
    }

    // ordenação
    if (sort === "price_asc") list.sort((a,b) => (Number(a.price)||0) - (Number(b.price)||0));
    if (sort === "price_desc") list.sort((a,b) => (Number(b.price)||0) - (Number(a.price)||0));
    if (sort === "title_asc") list.sort((a,b) => (a.title||"").localeCompare(b.title||""));
    if (sort === "title_desc") list.sort((a,b) => (b.title||"").localeCompare(a.title||""));
    // relevance = ordem do JSON (não mexe)

    // render
    grid.innerHTML = list.map(renderCard).join("");

    // deixa o card todo clicável (sem atrapalhar o botão)
    grid.querySelectorAll(".ml-card").forEach((card, idx) => {
      card.addEventListener("click", (e) => {
        if (e.target.closest("a")) return;
        const item = list[idx];
        window.open(buildMLUrl(item), "_blank", "noopener,noreferrer");
      });
    });

    updateBadges(list.length, "Tudo pronto");
  }

  async function initCatalog() {
    const grid = document.getElementById("mlGrid");
    updateBadges(0, "Carregando…");

    try {
      const res = await fetch(CATALOG_JSON_URL, { cache: "no-store" });
      if (!res.ok) throw new Error("Não achei o JSON em " + CATALOG_JSON_URL);
      const items = await res.json();

      // guarda ordem original
      originalItems = Array.isArray(items) ? items : [];
      updateBadges(originalItems.length, "Resolvendo imagens…");

      // resolve imagens locais (com limite de paralelismo simples)
      renderedItems = [];
      let done = 0;

      for (const it of originalItems) {
        const copy = { ...it };

        // 1) se o JSON já tiver "image", usa (mas você disse que vai ser local, então ok)
        // 2) senão, tenta achar na pasta pelo item_id
        if (copy.image && String(copy.image).trim()) {
          copy._resolved_image = String(copy.image).trim();
        } else if (copy.item_id) {
          copy._resolved_image = await resolveLocalImage(copy.item_id);
        } else {
          copy._resolved_image = "";
        }

        renderedItems.push(copy);
        done++;
        updateBadges(originalItems.length, `Resolvendo imagens… ${done}/${originalItems.length}`);
      }

      // listeners
      document.getElementById("catalogSearch")?.addEventListener("input", applySearchAndSort);
      document.getElementById("catalogSort")?.addEventListener("change", applySearchAndSort);

      // render inicial
      applySearchAndSort();

    } catch (err) {
      console.error(err);
      updateBadges(0, "Falha ao carregar");
      grid.innerHTML = `<div class="ml-skeleton">Não consegui carregar <b>${CATALOG_JSON_URL}</b>. Confere o caminho e se o JSON é válido.</div>`;
    }
  }

  document.addEventListener("DOMContentLoaded", initCatalog);
</script>
</body>
</html>
