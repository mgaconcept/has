<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cat√°logo ‚Ä¢ HAS</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css" />

  <!-- Estilos extras apenas para o cat√°logo (n√£o mexe no seu CSS principal) -->
  <style>
    /* Mant√©m a vibe do site, mas cria o ‚Äúcat√°logo Mercado Livre‚Äù */
    .catalog-toolbar {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      margin: 14px 0 18px;
    }

    .catalog-toolbar .left,
    .catalog-toolbar .right {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    .catalog-input, .catalog-select {
      font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(2, 6, 23, 0.35);
      color: #e2e8f0;
      outline: none;
      min-width: 240px;
    }

    .catalog-select { min-width: 200px; }

    .catalog-input::placeholder { color: rgba(226, 232, 240, 0.55); }

    .ml-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
      gap: 16px;
      margin-top: 14px;
    }

    .ml-card {
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 16px;
      overflow: hidden;
      background: rgba(0,0,0,0.28);
      backdrop-filter: blur(8px);
      display: flex;
      flex-direction: column;
      min-height: 330px;
      transition: transform .15s ease, border-color .15s ease;
      cursor: pointer;
    }

    .ml-card:hover {
      transform: translateY(-2px);
      border-color: rgba(250, 204, 21, 0.45); /* amarelo neon sutil */
    }

    .ml-img {
      width: 100%;
      aspect-ratio: 1 / 1;
      background: rgba(255,255,255,0.06);
      display: grid;
      place-items: center;
      overflow: hidden;
    }

    .ml-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.02);
    }

    .ml-body {
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
    }

    .ml-title {
      font-size: 0.9rem;
      line-height: 1.2;
      color: #e2e8f0;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      min-height: 2.2em;
    }

    .ml-price {
      font-size: 1.1rem;
      font-weight: 700;
      color: #fde047; /* amarelo forte */
    }

    .ml-meta {
      font-size: 0.78rem;
      color: rgba(226, 232, 240, 0.72);
    }

    .ml-actions {
      margin-top: auto;
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }

    .ml-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 0;
      cursor: pointer;
      text-decoration: none;
      font-weight: 700;
      width: 100%;
      background: #fde047;
      color: #111827;
      transition: transform .12s ease, filter .12s ease;
      user-select: none;
    }

    .ml-btn:hover { transform: translateY(-1px); filter: brightness(0.98); }

    .ml-skeleton {
      padding: 12px;
      color: rgba(226, 232, 240, 0.70);
      font-size: 0.9rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.25);
      background: rgba(2,6,23,0.25);
      color: rgba(226,232,240,0.85);
      font-size: 0.78rem;
    }

    .catalog-hint {
      margin-top: 6px;
      font-size: 0.85rem;
      color: rgba(226,232,240,0.75);
    }

    @media (max-width: 520px) {
      .catalog-input { min-width: 100%; }
      .catalog-select { min-width: 100%; }
      .catalog-toolbar { gap: 10px; }
    }
  </style>
</head>

<body>
  <!-- Navega√ß√£o -->
  <nav>
    <div class="logo">
      <a href="index.html"><img src="assets/img/logo.png" alt="Logo HAS" loading="lazy" /></a>
    </div>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="marcas.html">Marcas</a></li>
      <li><a href="diluicao.html">Calculadora de Dilui√ß√£o</a></li>
      <li><a href="nossaempresa.html">Quem Somos</a></li>
      <li><a href="contato.html">Fale Conosco</a></li>
    </ul>
    <div class="menu-toggle">
      <span></span><span></span><span></span>
    </div>
  </nav>

  <!-- Cabe√ßalho -->
  <section class="hero" style="background-image: url('assets/img/placeholder_light_gray_block.png');">
    <div class="hero-content">
      <h1>Cat√°logo</h1>
      <p>Produtos selecionados ‚Äî clique e compre direto no Mercado Livre</p>
    </div>
  </section>

  <!-- Conte√∫do: Cat√°logo -->
  <section class="content">
    <h2>Produtos</h2>

    <div class="catalog-toolbar">
      <div class="left">
        <input id="catalogSearch" class="catalog-input" type="search" placeholder="Buscar por nome‚Ä¶" />
        <select id="catalogSort" class="catalog-select">
          <option value="relevance">Ordenar: Relev√¢ncia</option>
          <option value="price_asc">Pre√ßo: menor ‚Üí maior</option>
          <option value="price_desc">Pre√ßo: maior ‚Üí menor</option>
          <option value="title_asc">Nome: A ‚Üí Z</option>
          <option value="title_desc">Nome: Z ‚Üí A</option>
        </select>
      </div>

      <div class="right">
        <span class="badge" id="catalogCount">0 itens</span>
        <span class="badge" id="catalogStatus">Carregando‚Ä¶</span>
      </div>
    </div>

    <p class="catalog-hint">
      //Dica: aqui voc√™ s√≥ cola links do Mercado Livre e o site puxa foto, nome e pre√ßo automaticamente.
    </p>

    <!-- Voc√™ s√≥ lista links aqui (um por item) -->
    <div class="ml-grid" id="mlGrid">
      <!-- EXEMPLOS: troque pelos seus -->
      <div class="ml-item" data-ml-url="https://produto.mercadolivre.com.br/MLB-6160149854-shampoo-multifuncional-500ml-ziox-alcance-remove-chuva-acida"></div>
      <div class="ml-item" data-ml-url="https://produto.mercadolivre.com.br/MLB9876543210-outro-produto-_JM"></div>
      <!-- Adicione mais assim:
      <div class="ml-item" data-ml-url="LINK_AQUI"></div>
      -->
    </div>
  </section>

  <!-- Rodap√© -->
  <footer>
    <div style="text-align: center; padding: 24px 0; color: #94a3b8; font-size: 0.875rem;">
      <p>&copy; 2025 HAS ‚Äì Produtos para Est√©tica Automotiva</p>
      <p>Da lavagem √† vitrifica√ß√£o, temos a solu√ß√£o! Desenvolvido por MGA Concept.</p>
      <p>
        <a href="mailto:hasprodutosautomotivos@gmail.com">hasprodutosautomotivos@gmail.com</a> |
        <a href="https://www.instagram.com/hasprodutosautomotivos/" target="_blank" rel="noopener">Instagram</a> |
        <a href="https://api.whatsapp.com/send/?phone=5543984510877&text&type=phone_number&app_absent=0" target="_blank" rel="noopener">WhatsApp</a>
      </p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="js/script.js"></script>
  <script src="js/banner_animado.js"></script>

  <script>
    // Smooth scroll (mantido)
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) target.scrollIntoView({ behavior: 'smooth' });
      });
    });

    // ============================
    // Cat√°logo Mercado Livre (auto-card)
    // ============================
    const state = {
      items: [],      // { el, url, id, title, price, img, condition, stock }
      loaded: 0
    };

    function extractMLItemId(url) {
  const u = String(url);

  // 1) Melhor caso: vem o wid=MLBxxxxxxxxxx
  const widMatch = u.match(/[?&]wid=(ML[A-Z]{1,3}\d{6,})/i);
  if (widMatch) return widMatch[1].toUpperCase();

  // 2) Pega ID no caminho, aceitando MLB-123 ou MLB_123 ou MLB123
  const pathMatch = u.match(/(ML[A-Z]{1,3})[-_]?(\d{6,})/i);
  if (pathMatch) return (pathMatch[1] + pathMatch[2]).toUpperCase();

  // 3) fallback: tenta achar qualquer MLB + numeros em qualquer lugar
  const anyMatch = u.match(/(ML[A-Z]{1,3}\d{6,})/i);
  return anyMatch ? anyMatch[1].toUpperCase() : null;
}

    function formatBRL(value) {
      try {
        return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
      } catch {
        return "R$ " + value;
      }
    }

    async function fetchItem(id) {
      const res = await fetch(`https://api.mercadolibre.com/items/${encodeURIComponent(id)}`);
      if (!res.ok) throw new Error("Falha ao buscar item " + id);
      return res.json();
    }

    function cardSkeleton() {
      return `<div class="ml-card"><div class="ml-skeleton">Carregando‚Ä¶</div></div>`;
    }

    function renderCardHTML(data, buyUrl) {
      const img = (data.pictures && data.pictures[0] && (data.pictures[0].secure_url || data.pictures[0].url)) || data.thumbnail || "";
      const title = data.title || "Produto";
      const price = (typeof data.price === "number") ? formatBRL(data.price) : "Pre√ßo indispon√≠vel";
      const condition = data.condition ? (data.condition === "new" ? "Novo" : "Usado") : "";
      const stock = (typeof data.available_quantity === "number") ? `Estoque: ${data.available_quantity}` : "";

      const meta = [condition, stock].filter(Boolean).join(" ‚Ä¢ ");

      return `
        <div class="ml-card" data-title="${(title || "").toLowerCase()}" data-price="${(data.price ?? 0)}">
          <div class="ml-img">${img ? `<img src="${img}" alt="${title}" loading="lazy">` : ""}</div>
          <div class="ml-body">
            <div class="ml-title">${title}</div>
            <div class="ml-price">${price}</div>
            <div class="ml-meta">${meta}</div>
            <div class="ml-actions">
              <a class="ml-btn" href="${buyUrl}" target="_blank" rel="noopener noreferrer">Comprar no Mercado Livre</a>
            </div>
          </div>
        </div>
      `;
    }

    function renderError(el, buyUrl) {
      el.innerHTML = `
        <div class="ml-card">
          <div class="ml-skeleton">N√£o consegui carregar esse item üòÖ</div>
          <div class="ml-body">
            <a class="ml-btn" href="${buyUrl}" target="_blank" rel="noopener noreferrer">Abrir no Mercado Livre</a>
          </div>
        </div>
      `;
    }

    function updateBadges() {
      const countEl = document.getElementById("catalogCount");
      const statusEl = document.getElementById("catalogStatus");

      const total = state.items.length;
      countEl.textContent = `${total} item${total === 1 ? "" : "s"}`;

      if (state.loaded >= total) statusEl.textContent = "Tudo pronto";
      else statusEl.textContent = `Carregando ${state.loaded}/${total}`;
    }

    function applySearchAndSort() {
      const q = (document.getElementById("catalogSearch").value || "").trim().toLowerCase();
      const sort = document.getElementById("catalogSort").value;

      const grid = document.getElementById("mlGrid");
      const cards = Array.from(grid.querySelectorAll(".ml-item"));

      // filtra
      cards.forEach(itemEl => {
        const card = itemEl.querySelector(".ml-card");
        if (!card) return;
        const title = card.getAttribute("data-title") || "";
        const show = !q || title.includes(q);
        itemEl.style.display = show ? "" : "none";
      });

      // ordena (s√≥ os vis√≠veis)
      const visible = cards.filter(el => el.style.display !== "none");
      const getPrice = (el) => Number(el.querySelector(".ml-card")?.getAttribute("data-price") || 0);
      const getTitle = (el) => (el.querySelector(".ml-card")?.getAttribute("data-title") || "");

      let sorted = visible.slice();

      switch (sort) {
        case "price_asc":
          sorted.sort((a,b) => getPrice(a) - getPrice(b));
          break;
        case "price_desc":
          sorted.sort((a,b) => getPrice(b) - getPrice(a));
          break;
        case "title_asc":
          sorted.sort((a,b) => getTitle(a).localeCompare(getTitle(b)));
          break;
        case "title_desc":
          sorted.sort((a,b) => getTitle(b).localeCompare(getTitle(a)));
          break;
        default:
          // relevance = ordem original (n√£o mexe)
          sorted = visible;
      }

      // re-append s√≥ os vis√≠veis na ordem
      sorted.forEach(el => grid.appendChild(el));
    }

    async function initMLCatalog() {
      const itemEls = document.querySelectorAll(".ml-item[data-ml-url]");
      state.items = Array.from(itemEls).map(el => ({
        el,
        url: el.getAttribute("data-ml-url"),
        id: extractMLItemId(el.getAttribute("data-ml-url"))
      }));

      // skeleton
      state.items.forEach(x => x.el.innerHTML = cardSkeleton());
      updateBadges();

      // listeners
      document.getElementById("catalogSearch").addEventListener("input", applySearchAndSort);
      document.getElementById("catalogSort").addEventListener("change", applySearchAndSort);

      // carrega (sequencial para ser ‚Äúeducado‚Äù com a API)
      for (const it of state.items) {
        if (!it.id) {
          renderError(it.el, it.url);
          state.loaded++;
          updateBadges();
          continue;
        }

        try {
          const data = await fetchItem(it.id);
          it.el.innerHTML = renderCardHTML(data, it.url);

          // deixa o card todo clic√°vel tamb√©m (al√©m do bot√£o)
          const card = it.el.querySelector(".ml-card");
          if (card) card.addEventListener("click", (e) => {
            // se clicou no bot√£o, n√£o duplica
            if (e.target.closest("a")) return;
            window.open(it.url, "_blank", "noopener,noreferrer");
          });

        } catch (err) {
          console.error(err);
          renderError(it.el, it.url);
        }

        state.loaded++;
        updateBadges();
        applySearchAndSort();
      }
    }

    document.addEventListener("DOMContentLoaded", initMLCatalog);
  </script>
</body>
</html>
